/*! jQuery Ctrl - v0.1.0 - 2014-07-21
* https://github.com/zengohm/jquery-ctrl
* Copyright (c) 2014 Zeng Ohm; Licensed MIT */
!function(a){var b=0,c=1,d=2,e={},f={};a.ctrl=function(b,c){var d={model:{},init:c,ctrl:a('[jq-ctrl="'+b+'"]')};e[b]=d,d.init(d.model),g(d)};var g=function(c){c.bindings=[],c.onChangeTasks=[];var e=[],g=function(h){h.contents().andSelf().each(function(){if(-1===e.indexOf(this)){e.push(this);var h=b;for(var i in f)if(h|=f[i](this,c.model,c.onChangeTasks),h&d)break;g(a(this))}})};g(c.ctrl)};f.text=function(a,e,f){if("#"===a.nodeName.substr(0,1)&&a.data.match(/\{\{\w+\}\}/)){var g=a.data;return f.push(function(){a.data=g.replace(/\{\{(\w+)\}\}/g,function(a,b){return e[b]})}),f[f.length-1](),c|d}return b},f.model=function(d,e,f){var g;return d.getAttribute&&(g=d.getAttribute("jq-model"))?(f.push(function(b){return d===b?!1:void a(d).val(e[g])}),f[f.length-1](),a(d).bind("keypress change keyup",function(){e[g]=a(this).val();for(var b in f)f[b](this)}),c):b},f.jqAttribute=function(a,c,d){if("function"!=typeof a.getAttribute)return b;for(var e=["jq-src","jq-href"],f=function(a,b,e){d.push(function(){a.setAttribute(b.substr(3),e.replace(/\{\{(\w+)\}\}/g,function(a,b){return c[b]}))})},g=0;g<e.length;g++){var h,i=e[g];(h=a.getAttribute(e[g]))&&(f(a,i,h),d[d.length-1]())}return b},f.otherAttribute=function(a,c,d){if("function"!=typeof a.getAttribute)return b;for(var e=a.attributes,f=function(a,b,e){d.push(function(){a.setAttribute(b,e.replace(/\{\{(\w+)\}\}/g,function(a,b){return c[b]}))})},g=0;g<e.length;g++)if("jq-"!==e[g].name.substr(0,3)){var h=e[g].value,i=e[g].name;h.match(/\{\{(\w+)\}\}/)&&(f(a,i,h),d[d.length-1](null))}return b},f.jqStyle=function(c,d,e){var f;return"function"==typeof c.getAttribute&&(f=c.getAttribute("jq-style"))?(e.push(function(){a(c).css(d[f])}),e[e.length-1](null),b):b},f.jqDisabled=function(c,d,e){var f;return"function"==typeof c.getAttribute&&(f=c.getAttribute("jq-disabled"))?(e.push(function(){a(c).attr("disabled",d[f])}),e[e.length-1](null),b):b},f.jqSelect=function(d,e,f){var g;if("SELECT"!==d.nodeName||!(g=d.getAttribute("jq-options")))return b;var h,i,j,k;if(h=g.match(/(\w+)/))i=null,j=null,k=h[1];else{if(!(h=g.match(/(\w+),(\w)+\s+in\s+(\w+)/)))return b;i=h[1],j=h[2],k=h[3]}return f.push(function(){a(d).empty();var b=d.getAttribute("jq-model");if(null===i)for(var c in e[k])a(d).append("<option>"+e[k][c]+"</option>");else for(var f in e[k])a(d).append('<option value="'+e[k][f][i]+'">'+e[k][f].valueName+"</option>");a(d).val(e[b])}),f[f.length-1](null),c},f.jqIf=function(c,d,e){var f;if("function"!=typeof c.getAttribute||!(f=c.getAttribute("jq-if")))return b;var g=document.createComment("jq-if "+f+" start"),h=document.createComment("jq-if "+f+" end"),i=a(c).parent()[0];return i.insertBefore(g,c),c.nextElementSibling?i.insertBefore(h,c.nextElementSibling):i.appendChild(h),e.push(function(){a(c).remove(),d[f]&&a(c).insertAfter(g)}),e[e.length-1](null),b},f.jqRepeat=function(d,e,f){var g,h;if("function"!=typeof d.getAttribute||!(g=d.getAttribute("jq-repeat"))||!(h=g.match(/(\w+)\s+in\s+(\w+)/)))return b;var i=h[2],j=h[1],k=document.createComment("jq-if "+g+" start"),l=document.createComment("jq-if "+g+" end"),m=a(d).prop("outerHTML"),n=a(d).parent()[0];n.insertBefore(k,d),d.nextElementSibling?n.insertBefore(l,d.nextElementSibling):n.appendChild(l);var o=function(a){return m.replace(/\{\{([\w\.]+)\}\}/g,function(b,c){return c.substr(0,j.length+1)===j+"."?a[c.substr(j.length+1)]:void 0})};return f.push(function(){for(var b=k.nextSibling;b!==l;)b=b.nextSibling,a(b).prev().remove();var c="",d=e[i];for(var f in d)c+=o(d[f]);a(c).insertAfter(k)}),f[f.length-1](null),c}}(jQuery);